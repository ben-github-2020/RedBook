#!/bin/bash

#COLORS
RESTORE='\033[0m'

RED='\033[00;31m'
GREEN='\033[00;32m'
YELLOW='\033[00;33m'
BLUE='\033[00;34m'
PURPLE='\033[00;35m'
CYAN='\033[00;36m'
LIGHTGRAY='\033[00;37m'

LRED='\033[01;31m'
LGREEN='\033[01;32m'
LYELLOW='\033[01;33m'
LBLUE='\033[01;34m'
LPURPLE='\033[01;35m'
LCYAN='\033[01;36m'
WHITE='\033[01;37m'

UL='\033[4m'    # underline




#command nmap custom
command_nmapcustom(){
echo -e "Vous avez choisi de faire un Nmap personalisé\n"
rm -f nmapcustom
touch nmapcustom
chmod +x nmapcustom
#cible
read -p "Indiquer votre cible : " target
echo "nmap $target" | tr -d "\n" >> nmapcustom
#scan technique
read -p "Scan technique ? (syn/ack/udp - default=syn) : " scantechnique
#METTRE LA LIGNE DU TRUC PAR DEFAUT
while [[ $scantechnique != syn || $scantechnique != ack || $scantechnique != udp ]]; do
	echo "/!\ Option invalide !"
	read -p "Scan technique ? (syn/ack/udp - default=syn) : " scantechnique
	#METTRE LA LIGNE DU TRUC PAR DEFAUT
done
if [[ $scantechnique == syn ]]; then
	echo " -sS" | tr -d "\n" >> nmapcustom
elif [[ $scantechnique == ack ]]; then
	echo " -sA" | tr -d "\n" >> nmapcustom
elif [[ $scantechnique == udp ]]; then
	echo " -sU" | tr -d "\n" >> nmapcustom
fi
#scan services
read -p "Scan services ? (yes/no - default=no) : " scanservice
#METTRE LA LIGNE DU TRUC PAR DEFAUT
while [[ $scanservice != yes || $scanservice != y || $scanservice != no || $scanservice != n ]]; do
	echo "/!\ Option invalide !"
	read -p "Scan services ? (yes/no - default=no) : " scanservice
	#METTRE LA LIGNE DU TRUC PAR DEFAUT
done
if [[ $scanservice == y || $scanservice == yes ]]; then 
	echo " -sV -version-all" | tr -d "\n" >> nmapcustom
fi
#scan OS
read -p "Scan operating system (yes/no - default=n) : " scanos
while [[ $scanos != yes || $scanos != y || $scanos != no || $scanos != n ]]; do
	echo "/!\ Option invalide !"
	read -p "Scan operating system (yes/no - default=n) : " scanos
	#METTRE LA LIGNE DU TRUC PAR DEFAUT
done
if [[ $scanos == y || $scanos == yes ]]; then
	echo " -O" | tr -d "\n" >> nmapcustom
fi
#scan script NSE
read -p "Use default scripts NSE (yes/no - default= no) " scannse
while [[ $scannse != yes || $scannse != y || $scannse != no || $scannse != n ]]; do
	echo "/!\ Option invalide !"
	read -p "Use default scripts NSE (yes/no - default= no) " scannse
	#METTRE LA LIGNE DU TRUC PAR DEFAUT
done
if [[ $scannnse == y || $scannse == yes ]]; then
	echo " -sC" >> nmapcustom
fi
#output
filename="Nmap_"$target"_"$(date +%F)"_"$(date +%T)
echo " -oA $filename" >> nmapcustom
#nmap
./nmapcustom
rm -f nmapcustom
echo -e "\n"
read -n 1 -s -r -p "Appuyer sur une touche pour retourner au menu principal "
menu_main
}

#Menu Nmap
menu_nmap(){
echo -e "${LRED}(1)${RESTORE} Nmap Classique"
echo -e "${LRED}(2)${RESTORE} Nmap Full"
echo -e "${LRED}(3)${RESTORE} Nmap Custom"
echo -e "\n${LRED}(0)${RESTORE} Retour Menu\n\n"

read -p $"Choisisssez une option:" option

if [[ $option == 1 ]]; then
	read -p $"Indiquer votre cible : " target
	filename="Nmap_"$target"_"$(date +%F)"_"$(date +%T)
	nmap $target -oA $filename
	echo -e "\n"
	read -n 1 -s -r -p "Appuyer sur une touche pour retourner au menu principal"
	menu_main
elif [[ $option == 2 ]]; then
	read -p $"Indiquer votre cible : " target
	filename="Nmap_"$target"_"$(date +%F)"_"$(date +%T)
	nmap $target -T4 -A -oA $filename
	echo -e "\n"
	read -n 1 -s -r -p "Appuyer sur une touche pour retourner au menu principal "
	menu_main
elif [[ $option == 3 ]]; then
	command_nmapcustom
elif [[ $option == 0 ]]; then
	menu_main
else
        echo -e "${LYELLOW}Vous n'avez pas choisi une option valable${RESTORE}\n"
        menu_nmap
fi
}

#Menu Principal
menu_main(){
clear
banner
echo -e "Vous travaillez actuellement sur le projet ${LBLUE}$name_projet${RESTORE}\n"
echo -e "Menu principal et actions possibles dans le ${LRED}RedBook${RESTORE}\n"
echo -e "${LRED}(1)${RESTORE} Nmap"
echo -e "\n${LRED}(Q)${RESTORE} Quitter\n\n"

read -p $"Choisisssez une option:" option

if [[ $option == 1 ]]; then
	menu_nmap
elif [[ $option == Q || $option == q ]]; then
	exit 1
else
	echo "vous n'avez pas choisi une option valable"
	menu_main
fi
}

#MENU Start: choix dossier
menu_start(){

#check ROOT
if [[ "$(id -u)" != 0 ]]; then
	echo -e "${LYELLOW}/!\ Ce programme doit être lancé en root !${RESTORE}\n"
	read -n 1 -s -r -p "Appuyer sur une touche pour quitter "
	exit 1
fi
#ajout de la timezone Paris
timedatectl set-timezone Europe/Paris
if [[ ! -d Projets ]]; then
	mkdir Projets
fi

echo -e "${LRED}(1)${RESTORE} Créer un nouveau projet"
echo -e "${LRED}(2)${RESTORE} Reprendre un projet en cours"
echo -e "\n${LRED}(Q)${RESTORE} Quitter\n\n"

read -p "Choisissez une option :" option

if [[ $option == 1 ]]; then
	read -p $"Nom du nouveau projet :" name_projet
	projet="Projets/"$name_projet
	while [[ -d $projet ]]; do
		echo -e "Le projet ${LBLUE}$name_projet${RESTORE} existe déjà.\n"
		read -p $"Nom du nouveau projet :" name_projet
		projet="Projets/"$name_projet
	done
	mkdir $projet
	cd $projet
	menu_main

elif [[ $option == 2 ]]; then
	echo -e "\n${UL}Voici les projets en cours${RESTORE}\n"
	ls Projets
	echo -e "\n"
	read -p $"Nom du projet à continuer :" name_projet
	projet="Projets/"$name_projet
	while [[ ! -d $projet ]]; do
		echo -e "${LYELLOW}/!\ Le projet ${LBLUE}$name_projet${LYELLOW} n'existe pas.${RESTORE}\n"
		read -p $"Nom du projet à continuer :" name_projet
		projet="Projets/"$name_projet
	done
	cd $projet
	menu_main

elif [[ $option == Q || $option == q ]]; then
	exit 1

else
	echo -e "\n${LYELLOW}/!\ ATTENTION vous n'avez pas choisi une option valable${RESTORE}\n\nRetour au menu..."
	sleep 5
	clear
	banner
	menu_start
fi
}

#BANNER
banner(){
echo -e "${LRED}
\t    ____________________   ___________________    
\t.-/|                    \ /                   |\-.
\t||||                     |                    ||||
\t||||  ____          _ ____              _     ||||
\t|||| |  _ \ ___  __| | __ )  ___   ___ | | __ ||||
\t|||| | |_) / _ \/ _\ |  _ \ / _ \ / _ \| |/ / ||||
\t|||| |  _ <  __/ (_| | |_) | (_) | (_) |   <  ||||
\t|||| |_| \_\___|\__,_|____/ \___/ \___/|_|\_\ ||||
\t||||                     |                    ||||
\t||||                     |                    ||||
\t||||                     |                    ||||
\t||||                     |                    ||||
\t||||                     |          benoit.g  ||||
\t||||                     |           cyril.d  ||||
\t||||____  ______________ | __________________ ||||
\t||/=====================\|/====================\||
\t'----------------------~___~--------------------''
${RESTORE}\n\t\tBonjour et bienvenue dans le ${LRED}RedBook${RESTORE}\n"
echo -e "Le ${LRED}RedBook${RESTORE} à été créé pour un usage éthique dans le cadre de tests d'intrusion"
echo -e "Le ${LRED}Redbook${RESTORE} ne doit en aucun cas être utilisé afin de nuire à toute personne physique ou morale\n\n\n"
}

#START
clear
banner
menu_start
